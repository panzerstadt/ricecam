(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{151:function(e,t,a){e.exports={gallery:"Show_gallery__34GpT"}},155:function(e,t,a){e.exports=a(333)},160:function(e,t,a){},161:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},162:function(e,t,a){},248:function(e,t){},250:function(e,t){},283:function(e,t){},284:function(e,t){},330:function(e,t){},331:function(e,t){},332:function(e,t){},333:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(146),c=a.n(o),i=(a(160),a(147)),s=a(148),u=a(152),l=a(149),d=a(153),f=(a(161),a(162),a(30)),m=a(6),p=a.n(m),v=a(16),b=a(7),g=a(8),h=a.n(g),A=(a(95),function(e,t){var a=Object(n.useRef)();Object(n.useEffect)(function(){a.current=e},[e]),Object(n.useEffect)(function(){if(null!==t){var e=setInterval(function(){a.current()},t);return function(){return clearInterval(e)}}},[t])}),E=a(150),j=a.n(E),P=void 0,_={width:800,height:800,facingMode:"environment"},R=function(e){var t=e.onRef,a=Object(n.useRef)(),o=Object(n.useState)(!1),c=Object(b.a)(o,2),i=c[0],s=c[1],u=function(){var e=Object(v.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=4;break}throw t="Browser API navigator.mediaDevices.getUserMedia not available",P.setState({error_messages:t}),t;case 4:a.current.video.onloadedmetadata=function(){s(!0)};case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){u()},[a]),i&&t&&t(a),r.a.createElement(j.a,{audio:!1,ref:a,screenshotFormat:"image/jpeg",videoConstraints:_,height:400,width:400})},O=a(151),w=a.n(O),D=R,S=function(e){var t=e.data;return r.a.createElement("div",{className:w.a.gallery},t&&t.map(function(e,t){return r.a.createElement("img",{key:t,src:e,alt:"img"})}))},y=a(154),C=a(66),I=a.n(C),T={apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).apiKey,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).authDomain,databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).databaseURL,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).projectId,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).storageBucket,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).messagingSenderId},Y={};Object.keys(T).map(function(e){Y[e]=Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"})["REACT_APP_".concat(e)]}),I.a.apps.length||I.a.initializeApp(Y);var k=I.a;h.a.locale("ja");var x=function(e,t){var a=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),n=h()().format("YYYY-MM-DD");k.firestore().collection("logs").doc(n).collection("logs").doc(a).set({message:e},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)})},L=function(){var e=Object(v.a)(p.a.mark(function e(t){var a,n,r,o,c,i,s,u,l,d,f,m,v;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e,t){var n={};for(var r in e)switch(typeof e[r]){case"function":t&&(n[r]="function: ".concat(e[r]));break;case"object":n[r]=a(e[r],t);break;case"number":n[r]=e[r];break;default:n[r]=e[r]}return n},n=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),r=h()().format("YYYY-MM-DD"),!("storage"in navigator&&"estimate"in navigator.storage)){e.next=10;break}return e.next=6,navigator.storage.estimate();case 6:c=e.sent,o={usage:c.usage,quota:c.quota,percent:"".concat((100*c.usage/c.quota).toFixed(0)," used")},e.next=11;break;case 10:o="browser does not have storage API";case 11:if(i=window.performance.memory||{},s="".concat(navigator.deviceMemory," GB")||!1,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection||navigator.msConnection,l=u?u.effectiveType:"browser does not have connection API",!("getBattery"in navigator)){e.next=19;break}return e.next=18,navigator.getBattery();case 18:d=e.sent;case 19:f=d?d.level:"browser does not have battery API",m=a(window.performance,!1),v={storage:o,ram:s,network:l,battery:f,performance:m,browserMemory:Object(y.a)({},a(i,!1),{usage:"".concat(i.totalJSHeapSize/i.jsHeapSizeLimit*100," percent"),comment:"units in bytes. percent is percent of allocated browser memory (multiple tabs included)"})},k.firestore().collection("logs").doc(r).collection("browser performance logs").doc(n).set({status:v},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)});case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),U=function(e){var t=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=h()().format("YYYY-MM-DD");k.storage().ref("".concat("images","/").concat(t,".png")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var t=e.ref.location.path;k.firestore().collection("imageURL").doc(a).collection("urls").doc().set({url:t})}).catch(function(e){var t="pushImageDataToStorage: ERROR ".concat(e);x(t,function(){return console.log(t)})})},N=function(){var e=Object(v.a)(p.a.mark(function e(t){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t?h()(t).format("YYYY-MM-DD"):h()().format("YYYY-MM-DD"),console.log("grabbing videos from: ",a),e.next=4,k.firestore().collection("videoURL").doc(a).collection("urls").get().then(function(){var e=Object(v.a)(p.a.mark(function e(t){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.forEach(function(){var e=Object(v.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data().url,e.next=3,k.storage().ref(n).getDownloadURL().then(function(e){a.push(e)});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),B=function(e){var t=e.videoRef,a=e.triggerRecording,o=e.duration,c=e.onComplete,i=e.previewVideo,s="video/webm",u=".mp4",l=Object(n.useState)(""),d=Object(b.a)(l,2),m=d[0],p=d[1],v=Object(n.useState)(5e3),g=Object(b.a)(v,2),h=g[0],A=g[1];Object(n.useEffect)(function(){o&&"number"===typeof o&&A(o)},[o]);var E=Object(n.useState)(!1),j=Object(b.a)(E,2),P=j[0],_=(j[1],Object(n.useState)([])),R=Object(b.a)(_,2),O=(R[0],R[1],Object(n.useState)([])),w=Object(b.a)(O,2),D=w[0],S=w[1];Object(n.useRef)();Object(n.useEffect)(function(){!0===a&&!1===P&&(x("VideoRecorder: START starting one recording"),C({duration:h}))},[a,P]),Object(n.useEffect)(function(){D.length>0&&(console.log("making link!",D),i&&y())},[D]);var y=function(){var e=new Blob(D,{type:s}),t=URL.createObjectURL(e),a=r.a.createElement("li",{key:t},r.a.createElement("video",{height:200,controls:!0,src:t}),r.a.createElement("br",null),r.a.createElement("a",{href:t,download:"video".concat(u)},"download ".concat("video".concat(u))));p([].concat(Object(f.a)(m),[a]))},C=function(e){if(e.duration,t){var a=t.current.stream;a.active||console.log("media stream is not active.",a);var n=new MediaRecorder(a);n.ondataavailable=function(e){S([e.data]),c&&c(e.data)},n.onstart=function(e){S([]),setTimeout(function(){n.stop()},h)},n.start()}};return r.a.createElement("ul",{style:{display:"flex",listStyleType:"none",width:"100%",overflowX:"scroll"}},m)},M=a(67),H=function(){var e=Object(v.a)(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a("assets/model/brightness-predictor.json");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(v.a)(p.a.mark(function e(t){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:if(!(a=e.sent)){e.next=7;break}return e.next=6,M.c(function(){var e=[Array.from(t)],n=M.b(e,[e.length,432]);console.log(n);var r=a.predict(n);return r.print(),r.arraySync()[0][0]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=Object(v.a)(p.a.mark(function e(t){var a,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getContext("2d").getImageData(0,0,t.width,t.height),console.log(a),n=a.data,e.next=5,z(n);case 5:return r=e.sent,console.log(r),e.abrupt("return",r>.6);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();h.a.locale("ja");var G=function(e){var t=e.videoRef,a=e.isDetecting,r=e.delay,o=e.onDetect,c=Object(n.useState)(500),i=Object(b.a)(c,2),s=i[0],u=i[1];Object(n.useEffect)(function(){r&&"number"===typeof r&&u(r)},[r]),A(function(){l()},a?s:null);var l=function(){var e=Object(v.a)(p.a.mark(function e(){var a,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return a=t.current.video,(n=document.createElement("canvas")).width=12,n.height=9,n.getContext("2d").drawImage(a,0,0,n.width,n.height),e.next=9,V(n);case 9:r=e.sent,o&&o({bright:r});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return null},J=function(){var e=Object(n.useState)([]),t=Object(b.a)(e,2),a=t[0],o=t[1];return Object(n.useEffect)(function(){N().then(function(e){console.log("paths"),console.log(e),o(e)})},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"current list of videos today (",a.length,"): "),r.a.createElement("ul",{style:{whiteSpace:"nowrap",fontSize:"0.5rem",listStyleType:"none",height:300,overflow:"scroll"}},a.map(function(e,t){return r.a.createElement("li",{key:t,style:{margin:"5px 0"}},r.a.createElement("a",{href:e},e))})))},K=function(e){var t=e.showPreviews,a=void 0!==t&&t,o=Object(n.useState)(),c=Object(b.a)(o,2),i=c[0],s=c[1],u=Object(n.useState)([]),l=Object(b.a)(u,2),d=l[0],m=l[1],g=Object(n.useState)(!0),E=Object(b.a)(g,2),j=E[0],P=E[1],_=function(e){m([].concat(Object(f.a)(d.slice(-4)),[e])),x(e,function(e){return console.log("LOGGER: completed. ",e)})};A(function(){console.log("logging browser performance"),L()},6e4);var R=Object(n.useState)(!1),O=Object(b.a)(R,2),w=O[0],y=O[1],C=Object(n.useState)(!1),I=Object(b.a)(C,2),T=I[0],Y=I[1],M=Object(n.useState)(!1),H=Object(b.a)(M,2),z=H[0],V=H[1];A(function(){var e=h()().format("YYYY-MM-DDTHH:mm:ss:SSS");T?_("recording still underway, not setting recording to true"):(_("recording video at ".concat(e)),Y(!0))},z?3e5:null);var K=Object(n.useState)(1e3),W=Object(b.a)(K,2),q=W[0],F=(W[1],Object(n.useState)(!1)),X=Object(b.a)(F,2),$=X[0];X[1];A(function(){ce()},$?q:null);var Q=Object(n.useState)([]),Z=Object(b.a)(Q,2),ee=Z[0],te=Z[1],ae=Object(n.useState)([]),ne=Object(b.a)(ae,2),re=ne[0],oe=ne[1],ce=function(){if(i){var e,t=i.current.video,a=document.createElement("canvas");a.width=1*t.videoWidth,a.height=1*t.videoHeight,(e=a.getContext("2d")).drawImage(t,0,0,a.width,a.height);var n=a.toDataURL();te([].concat(Object(f.a)(ee),[n])),e.clearRect(0,0,a.width,a.height),a.width=.02*t.videoWidth,a.height=.02*t.videoHeight,(e=a.getContext("2d")).drawImage(t,0,0,a.width,a.height);var r=e.getImageData(0,0,a.width,a.height);console.log(r);var o=function(e){var t=[];for(var a in e)t.push(e[a]);return t}(r.data);return oe([].concat(Object(f.a)(re),[o])),ee}},ie=Object(n.useState)(100),se=Object(b.a)(ie,2),ue=se[0],le=se[1],de=Object(n.useState)(!1),fe=Object(b.a)(de,2),me=fe[0],pe=fe[1];A(function(){ve()},me?ue:null);var ve=function(){if(i){var e=i.current.video,t=document.createElement("canvas");t.width=1*e.videoWidth,t.height=1*e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height);var a=t.toDataURL();te([].concat(Object(f.a)(ee),[a])),t.toBlob(function(e){console.log(e),U(e)})}};return Object(n.useEffect)(function(){if(i){var e=i.current.video;e.height=.1*e.videoHeight,e.width=.1*e.videoWidth,console.log(i.current.video)}},[i]),r.a.createElement("div",{style:{backgroundColor:j?"white":"#282c34"}},r.a.createElement(D,{onRef:s}),r.a.createElement("br",null),r.a.createElement("code",null,"debug buttons: "),r.a.createElement("button",{onClick:Object(v.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:t=e.sent,console.log(t),console.log(typeof t);case 5:case"end":return e.stop()}},e)}))},"list videos recorded today"),r.a.createElement("button",{onClick:function(){_("streaming images to database!"),me?(console.log("stopping!"),pe(!1),le(1e3)):(console.log("capturing!"),le(1),pe(!0))}},"toggle stream to database"),r.a.createElement("button",{onClick:function(){y(!w)}},"toggle brightness detection"),r.a.createElement("button",{style:{color:T?"red":"black"},onClick:function(){return Y(!T)}},"record 5 sec"),r.a.createElement("button",{onClick:function(){Y(!0),V(!0),setTimeout(function(){V(!1)},36e5)}},"record 5 sec videos for 1 hour"),r.a.createElement("button",{onClick:function(){_("recording forever!"),Y(!0),V(!0)}},"record 5 sec indefinitely"),r.a.createElement("br",null),r.a.createElement("ul",null,d.map(function(e,t){return r.a.createElement("li",{key:t},e)})),r.a.createElement("br",null),a&&r.a.createElement(S,{data:ee}),r.a.createElement(B,{videoRef:i,triggerRecording:T,duration:5e3,previewVideo:a,onComplete:function(e){console.log(e),function(e){var t=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=h()().format("YYYY-MM-DD");k.storage().ref("".concat("videos","/").concat(t,".mp4")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var n=e.ref.location.path;k.firestore().collection("videoURL").doc(a).collection("urls").doc().set({url:n}).then(function(e){var a="pushVideoDataToStorage: COMPLETE video:".concat("videos","/").concat(t,".mp4, ref: ").concat(n,", callback: ").concat(e);x(a,function(){return console.log(a)})})}).catch(function(e){var t="pushVideoDataToStorage: ERROR ".concat(e);x(t,function(){return console.log(t)})})}(e),Y(!1)}}),r.a.createElement(J,null),r.a.createElement(G,{videoRef:i,isDetecting:w,delay:1e3,onDetect:function(e){return P(e.bright)}}))},W=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(K,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[155,1,2]]]);
//# sourceMappingURL=main.2da4db49.chunk.js.map