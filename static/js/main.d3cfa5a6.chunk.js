(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{151:function(e,t,a){e.exports={gallery:"Show_gallery__34GpT"}},154:function(e,t,a){e.exports=a(332)},159:function(e,t,a){},160:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},161:function(e,t,a){},247:function(e,t){},249:function(e,t){},282:function(e,t){},283:function(e,t){},329:function(e,t){},330:function(e,t){},331:function(e,t){},332:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),o=a(146),c=a.n(o),i=(a(159),a(147)),s=a(148),u=a(152),l=a(149),d=a(153),p=(a(160),a(161),a(34)),f=a(7),m=a.n(f),b=a(16),v=a(6),g=a(10),h=a.n(g),A=(a(95),function(e,t){var a=Object(n.useRef)();Object(n.useEffect)(function(){a.current=e},[e]),Object(n.useEffect)(function(){if(null!==t){var e=setInterval(function(){a.current()},t);return function(){return clearInterval(e)}}},[t])}),j=a(150),_=a.n(j),E=void 0,P={width:800,height:800,facingMode:"environment"},R=function(e){var t=e.onRef,a=Object(n.useRef)(),o=Object(n.useState)(!1),c=Object(v.a)(o,2),i=c[0],s=c[1],u=function(){var e=Object(b.a)(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=4;break}throw t="Browser API navigator.mediaDevices.getUserMedia not available",E.setState({error_messages:t}),t;case 4:a.current.video.onloadedmetadata=function(){s(!0)};case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){u()},[a]),i&&t&&t(a),r.a.createElement(_.a,{audio:!1,ref:a,screenshotFormat:"image/jpeg",videoConstraints:P,height:400,width:400})},O=a(151),w=a.n(O),C=R,D=function(e){var t=e.data;return r.a.createElement("div",{className:w.a.gallery},t&&t.map(function(e,t){return r.a.createElement("img",{key:t,src:e,alt:"img"})}))},y=function(e){var t=e.videoRef,a=e.triggerRecording,o=e.duration,c=e.onComplete,i=e.previewVideo,s="video/webm",u=".mp4",l=Object(n.useState)(""),d=Object(v.a)(l,2),f=d[0],m=d[1],b=Object(n.useState)(5e3),g=Object(v.a)(b,2),h=g[0],A=g[1];Object(n.useEffect)(function(){o&&"number"===typeof o&&A(o)},[o]);var j=Object(n.useState)(!1),_=Object(v.a)(j,2),E=_[0],P=(_[1],Object(n.useState)([])),R=Object(v.a)(P,2),O=(R[0],R[1],Object(n.useState)([])),w=Object(v.a)(O,2),C=w[0],D=w[1];Object(n.useRef)();Object(n.useEffect)(function(){!0===a&&!1===E&&I({duration:h})},[a,E]),Object(n.useEffect)(function(){C.length>0&&(console.log("making linl!",C),i&&y())},[C]);var y=function(){var e=new Blob(C,{type:s}),t=URL.createObjectURL(e),a=r.a.createElement("li",{key:t},r.a.createElement("video",{height:200,controls:!0,src:t}),r.a.createElement("br",null),r.a.createElement("a",{href:t,download:"video".concat(u)},"download ".concat("video".concat(u))));m([].concat(Object(p.a)(f),[a]))},I=function(e){if(e.duration,t){var a=t.current.stream;a.active||console.log("media stream is not active.",a);var n=new MediaRecorder(a);n.ondataavailable=function(e){D([e.data]),c&&c(e.data)},n.onstart=function(e){D([]),setTimeout(function(){n.stop()},h)},n.start()}};return r.a.createElement("ul",{style:{display:"flex",listStyleType:"none",width:"100%",overflowX:"scroll"}},f)},I=a(66),S=a.n(I),T={apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).apiKey,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).authDomain,databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).databaseURL,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).projectId,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).storageBucket,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).messagingSenderId},k={};Object.keys(T).map(function(e){k[e]=Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"})["REACT_APP_".concat(e)]}),S.a.apps.length||S.a.initializeApp(k);var Y=S.a;h.a.locale("ja");var U=function(e){var t=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=h()().format("YYYY-MM-DD");Y.storage().ref("".concat("images","/").concat(t,".png")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var t=e.ref.location.path;Y.firestore().collection("imageURL").doc(a).collection("urls").doc().set({url:t})}).catch(function(e){return console.log("error! ",e)})},x=function(){var e=Object(b.a)(m.a.mark(function e(t){var a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t?h()(t).format("YYYY-MM-DD"):h()().format("YYYY-MM-DD"),console.log("grabbing videos from: ",a),e.next=4,Y.firestore().collection("videoURL").doc(a).collection("urls").get().then(function(){var e=Object(b.a)(m.a.mark(function e(t){var a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.forEach(function(){var e=Object(b.a)(m.a.mark(function e(t){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data().url,e.next=3,Y.storage().ref(n).getDownloadURL().then(function(e){a.push(e)});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),L=a(67),N=function(){var e=Object(b.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a("assets/model/brightness-predictor.json");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(b.a)(m.a.mark(function e(t){var a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:if(!(a=e.sent)){e.next=7;break}return e.next=6,L.c(function(){var e=[Array.from(t)],n=L.b(e,[e.length,432]);console.log(n);var r=a.predict(n);return r.print(),r.arraySync()[0][0]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(b.a)(m.a.mark(function e(t){var a,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getContext("2d").getImageData(0,0,t.width,t.height),console.log(a),n=a.data,e.next=5,B(n);case 5:return r=e.sent,console.log(r),e.abrupt("return",r>.6);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();h.a.locale("ja");var z=function(e){var t=e.videoRef,a=e.isDetecting,r=e.delay,o=e.onDetect,c=Object(n.useState)(500),i=Object(v.a)(c,2),s=i[0],u=i[1];Object(n.useEffect)(function(){r&&"number"===typeof r&&u(r)},[r]),A(function(){l()},a?s:null);var l=function(){var e=Object(b.a)(m.a.mark(function e(){var a,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return a=t.current.video,(n=document.createElement("canvas")).width=12,n.height=9,n.getContext("2d").drawImage(a,0,0,n.width,n.height),e.next=9,M(n);case 9:r=e.sent,o&&o({bright:r});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return null},J=function(){var e=Object(n.useState)([]),t=Object(v.a)(e,2),a=t[0],o=t[1];return Object(n.useEffect)(function(){x().then(function(e){console.log("paths"),console.log(e),o(e)})},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"current list of videos today (",a.length,"): "),r.a.createElement("ul",{style:{whiteSpace:"nowrap",fontSize:"0.5rem",listStyleType:"none",height:300,overflow:"scroll"}},a.map(function(e,t){return r.a.createElement("li",{key:t,style:{margin:"5px 0"}},r.a.createElement("a",{href:e},e))})))},K=function(e){var t=e.showPreviews,a=void 0!==t&&t,o=Object(n.useState)(),c=Object(v.a)(o,2),i=c[0],s=c[1],u=Object(n.useState)(!0),l=Object(v.a)(u,2),d=l[0],f=l[1],g=Object(n.useState)(!1),j=Object(v.a)(g,2),_=j[0],E=j[1],P=Object(n.useState)(!1),R=Object(v.a)(P,2),O=R[0],w=R[1],I=Object(n.useState)(!1),S=Object(v.a)(I,2),T=S[0],k=S[1];A(function(){O?console.log("recording still underway..."):w(!0)},T?3e5:null);var L=Object(n.useState)(1e3),N=Object(v.a)(L,2),B=N[0],M=(N[1],Object(n.useState)(!1)),K=Object(v.a)(M,2),V=K[0];K[1];A(function(){Z()},V?B:null);var H=Object(n.useState)([]),W=Object(v.a)(H,2),F=W[0],G=W[1],X=Object(n.useState)([]),$=Object(v.a)(X,2),q=$[0],Q=$[1],Z=function(){if(i){var e,t=i.current.video,a=document.createElement("canvas");a.width=1*t.videoWidth,a.height=1*t.videoHeight,(e=a.getContext("2d")).drawImage(t,0,0,a.width,a.height);var n=a.toDataURL();G([].concat(Object(p.a)(F),[n])),e.clearRect(0,0,a.width,a.height),a.width=.02*t.videoWidth,a.height=.02*t.videoHeight,(e=a.getContext("2d")).drawImage(t,0,0,a.width,a.height);var r=e.getImageData(0,0,a.width,a.height);console.log(r);var o=function(e){var t=[];for(var a in e)t.push(e[a]);return t}(r.data);return Q([].concat(Object(p.a)(q),[o])),F}},ee=Object(n.useState)(100),te=Object(v.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)(!1),oe=Object(v.a)(re,2),ce=oe[0],ie=oe[1];A(function(){se()},ce?ae:null);var se=function(){if(i){var e=i.current.video,t=document.createElement("canvas");t.width=1*e.videoWidth,t.height=1*e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height);var a=t.toDataURL();G([].concat(Object(p.a)(F),[a])),t.toBlob(function(e){console.log(e),U(e)})}};return Object(n.useEffect)(function(){if(i){var e=i.current.video;e.height=.1*e.videoHeight,e.width=.1*e.videoWidth,console.log(i.current.video)}},[i]),r.a.createElement("div",{style:{backgroundColor:d?"white":"#282c34"}},r.a.createElement(C,{onRef:s}),r.a.createElement("br",null),r.a.createElement("code",null,"debug buttons: "),r.a.createElement("button",{onClick:Object(b.a)(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:t=e.sent,console.log(t),console.log(typeof t);case 5:case"end":return e.stop()}},e)}))},"list videos recorded today"),r.a.createElement("button",{onClick:function(){ce?(console.log("stopping!"),ie(!1),ne(1e3)):(console.log("capturing!"),ne(1),ie(!0))}},"toggle stream to database"),r.a.createElement("button",{onClick:function(){E(!_)}},"toggle brightness detection"),r.a.createElement("button",{style:{color:O?"red":"black"},onClick:function(){return w(!O)}},"record 5 sec"),r.a.createElement("button",{onClick:function(){w(!0),k(!0),setTimeout(function(){k(!1)},36e5)}},"record 5 sec videos for 1 hour"),r.a.createElement("button",{onClick:function(){console.log("recording forever!"),w(!0),k(!0)}},"record 5 sec indefinitely"),r.a.createElement("br",null),r.a.createElement("br",null),a&&r.a.createElement(D,{data:F}),r.a.createElement(y,{videoRef:i,triggerRecording:O,duration:5e3,previewVideo:!0,onComplete:function(e){console.log(e),function(e){var t=h()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=h()().format("YYYY-MM-DD");Y.storage().ref("".concat("videos","/").concat(t,".mp4")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var t=e.ref.location.path;Y.firestore().collection("videoURL").doc(a).collection("urls").doc().set({url:t})}).catch(function(e){return console.log("error! ",e)})}(e),w(!1)}}),r.a.createElement(J,null),r.a.createElement(z,{videoRef:i,isDetecting:_,delay:1e3,onDetect:function(e){return f(e.bright)}}))},V=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(K,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[154,1,2]]]);
//# sourceMappingURL=main.d3cfa5a6.chunk.js.map