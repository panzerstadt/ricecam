(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{151:function(e,t,n){e.exports={gallery:"Show_gallery__34GpT"}},155:function(e,t,n){e.exports=n(333)},160:function(e,t,n){},161:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},162:function(e,t,n){},248:function(e,t){},250:function(e,t){},283:function(e,t){},284:function(e,t){},330:function(e,t){},331:function(e,t){},332:function(e,t){},333:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(146),c=n.n(o),i=(n(160),n(147)),s=n(148),u=n(152),l=n(149),f=n(153),d=(n(161),n(162),n(7)),p=n.n(d),m=n(14),b=n(27),v=n(6),g=n(8),A=n.n(g),h=(n(95),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)(function(){n.current=e},[e]),Object(a.useEffect)(function(){if(null!==t){var e=setInterval(function(){n.current()},t);return function(){return clearInterval(e)}}},[t])}),j=n(150),P=n.n(j),E=void 0,_={width:800,height:800,facingMode:"environment"},O=function(e){var t=e.onRef,n=Object(a.useRef)(),o=Object(a.useState)(!1),c=Object(v.a)(o,2),i=c[0],s=c[1],u=function(){var e=Object(m.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=4;break}throw t="Browser API navigator.mediaDevices.getUserMedia not available",E.setState({error_messages:t}),t;case 4:n.current.video.onloadedmetadata=function(){s(!0)};case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)(function(){u()},[n]),i&&t&&t(n),r.a.createElement(P.a,{audio:!1,ref:n,screenshotFormat:"image/jpeg",videoConstraints:_,height:400,width:400})},R=(n(151),O),w=n(154),S=n(66),y=n.n(S),D={apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).apiKey,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).authDomain,databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).databaseURL,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).projectId,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).storageBucket,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).messagingSenderId},C={};Object.keys(D).map(function(e){C[e]=Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"})["REACT_APP_".concat(e)]}),y.a.apps.length||y.a.initializeApp(C);var I=y.a;A.a.locale("ja");var T=function(e,t){var n=A()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=A()().format("YYYY-MM-DD");I.firestore().collection("logs").doc(a).collection("logs").doc(n).set({message:e},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)})},Y=function(){var e=Object(m.a)(p.a.mark(function e(t){var n,a,r,o,c,i,s,u,l,f,d,m,b;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e,t){var a={};for(var r in e)switch(typeof e[r]){case"function":t&&(a[r]="function: ".concat(e[r]));break;case"object":a[r]=n(e[r],t);break;case"number":a[r]=e[r];break;default:a[r]=e[r]}return a},a=A()().format("YYYY-MM-DDTHH:mm:ss:SSS"),r=A()().format("YYYY-MM-DD"),!("storage"in navigator&&"estimate"in navigator.storage)){e.next=10;break}return e.next=6,navigator.storage.estimate();case 6:c=e.sent,o={usage:c.usage,quota:c.quota,percent:"".concat((100*c.usage/c.quota).toFixed(0)," used")},e.next=11;break;case 10:o="browser does not have storage API";case 11:if(i=window.performance.memory||{},s="".concat(navigator.deviceMemory," GB")||!1,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection||navigator.msConnection,l=u?u.effectiveType:"browser does not have connection API",!("getBattery"in navigator)){e.next=19;break}return e.next=18,navigator.getBattery();case 18:f=e.sent;case 19:d=f?f.level:"browser does not have battery API",m=n(window.performance,!1),b={storage:o,ram:s,network:l,battery:d,performance:m,browserMemory:Object(w.a)({},n(i,!1),{usage:"".concat(i.totalJSHeapSize/i.jsHeapSizeLimit*100," percent"),comment:"units in bytes. percent is percent of allocated browser memory (multiple tabs included)"})},I.firestore().collection("logs").doc(r).collection("browser performance logs").doc(a).set({status:b},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)});case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(m.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?A()(t).format("YYYY-MM-DD"):A()().format("YYYY-MM-DD"),console.log("grabbing videos from: ",n),e.next=4,I.firestore().collection("videoURL").doc(n).collection("urls").get().then(function(){var e=Object(m.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,t.forEach(function(){var e=Object(m.a)(p.a.mark(function e(t){var a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data().url,e.next=3,I.storage().ref(a).getDownloadURL().then(function(e){n.push(e)});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),x=function(e){var t=e.videoRef,n=e.triggerRecording,o=e.duration,c=e.onComplete,i=e.showPreview,s="video/webm",u=".mp4",l=Object(a.useState)(""),f=Object(v.a)(l,2),d=f[0],p=f[1],m=Object(a.useState)(5e3),g=Object(v.a)(m,2),A=g[0],h=g[1];Object(a.useEffect)(function(){o&&"number"===typeof o&&h(o)},[o]);var j=Object(a.useState)(!1),P=Object(v.a)(j,2),E=P[0],_=(P[1],Object(a.useState)([])),O=Object(v.a)(_,2),R=(O[0],O[1],Object(a.useState)([])),w=Object(v.a)(R,2),S=w[0],y=w[1];Object(a.useRef)();Object(a.useEffect)(function(){!0===n&&!1===E&&(T("VideoRecorder: START starting one recording"),C({duration:A}))},[n,E]),Object(a.useEffect)(function(){S.length>0&&(console.log("making link!",S),i&&D())},[S]);var D=function(){var e=new Blob(S,{type:s}),t=URL.createObjectURL(e),n=r.a.createElement("li",{key:t},r.a.createElement("video",{height:200,controls:!0,src:t}),r.a.createElement("br",null),r.a.createElement("a",{href:t,download:"video".concat(u)},"download ".concat("video".concat(u))));p([].concat(Object(b.a)(d),[n]))},C=function(e){if(e.duration,t){var n=t.current.stream;n.active||console.log("media stream is not active.",n);var a=new MediaRecorder(n);a.ondataavailable=function(e){y([e.data]),c&&c(e.data)},a.onstart=function(e){y([]),setTimeout(function(){a.stop()},A)},a.start()}};return r.a.createElement("ul",{style:{display:"flex",listStyleType:"none",width:"100%",overflowX:"scroll"}},d)},L=n(67),N=function(){var e=Object(m.a)(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a("assets/model/brightness-predictor.json");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(m.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:if(!(n=e.sent)){e.next=7;break}return e.next=6,L.c(function(){var e=[Array.from(t)],a=L.b(e,[e.length,432]);console.log(a);var r=n.predict(a);return r.print(),r.arraySync()[0][0]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=Object(m.a)(p.a.mark(function e(t){var n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getContext("2d").getImageData(0,0,t.width,t.height),console.log(n),a=n.data,e.next=5,B(a);case 5:return r=e.sent,console.log(r),e.abrupt("return",r>.6);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(e){var t=e.videoRef,n=e.isDetecting,r=e.delay,o=e.onDetect,c=Object(a.useState)(500),i=Object(v.a)(c,2),s=i[0],u=i[1];Object(a.useEffect)(function(){r&&"number"===typeof r&&u(r)},[r]),h(function(){l()},n?s:null);var l=function(){var e=Object(m.a)(p.a.mark(function e(){var n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return n=t.current.video,(a=document.createElement("canvas")).width=12,a.height=9,a.getContext("2d").drawImage(n,0,0,a.width,a.height),e.next=9,U(a);case 9:r=e.sent,o&&o({bright:r});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return null};A.a.locale("ja");var z=function(){var e=Object(a.useState)([]),t=Object(v.a)(e,2),n=t[0],o=t[1];return Object(a.useEffect)(function(){k().then(function(e){console.log("paths"),console.log(e),o(e)})},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"current list of videos today (",n.length,"): "),r.a.createElement("ul",{style:{whiteSpace:"nowrap",fontSize:"0.5rem",listStyleType:"none",height:300,overflow:"scroll"}},n.map(function(e,t){return r.a.createElement("li",{key:t,style:{margin:"5px 0"}},r.a.createElement("a",{href:e},e))})))},H=function(e){var t=e.showPreviews,n=void 0!==t&&t,o=Object(a.useState)(),c=Object(v.a)(o,2),i=c[0],s=c[1],u=Object(a.useState)([]),l=Object(v.a)(u,2),f=l[0],d=l[1],g=Object(a.useState)(!0),j=Object(v.a)(g,2),P=j[0],E=j[1],_=function(e){d([].concat(Object(b.a)(f.slice(-4)),[e])),T(e,function(e){return console.log("LOGGER: completed. ",e)})};h(function(){console.log("logging browser performance"),Y()},6e4);var O=Object(a.useState)(!1),w=Object(v.a)(O,2),S=w[0],y=w[1],D=Object(a.useState)(!1),C=Object(v.a)(D,2),L=C[0],N=C[1],B=Object(a.useState)(5e3),U=Object(v.a)(B,2),H=U[0],J=U[1],G=Object(a.useState)(!1),V=Object(v.a)(G,2),K=V[0],q=V[1];h(function(){var e=A()().format("YYYY-MM-DDTHH:mm:ss:SSS");L?_("recording still underway, not setting recording to true"):(_("recording video at ".concat(e)),N(!0))},K?3e5:null);var F=Object(a.useState)(1e3),W=Object(v.a)(F,2),X=(W[0],W[1],Object(a.useState)(!1)),$=Object(v.a)(X,2),Q=($[0],$[1],Object(a.useState)(100)),Z=Object(v.a)(Q,2),ee=(Z[0],Z[1],Object(a.useState)(!1)),te=Object(v.a)(ee,2),ne=(te[0],te[1],Object(a.useState)({})),ae=Object(v.a)(ne,2),re=ae[0],oe=ae[1];Object(a.useEffect)(function(){var e;console.log("listening to DB!"),e=oe,I.firestore().collection("appState").doc("commands").onSnapshot(function(t){return e&&e(t.data()),t.data()})},[]),console.log(re),Object(a.useEffect)(function(){re&&(_("commands received: ".concat(JSON.stringify(re))),ie(re.setContinuousRecording),ce(re.videoDurationSec))},[re]);var ce=function(e){J(e)},ie=function(e){e?(_("recording forever!"),N(!0),q(!0)):(N(!1),q(!1))};return Object(a.useEffect)(function(){if(i){var e=i.current.video;e.height=.1*e.videoHeight,e.width=.1*e.videoWidth,console.log(i.current.video)}},[i]),r.a.createElement("div",{style:{backgroundColor:P?"white":"#282c34"}},r.a.createElement(R,{onRef:s}),r.a.createElement("br",null),r.a.createElement("code",null,"debug buttons: "),r.a.createElement("button",{onClick:Object(m.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:t=e.sent,console.log(t),console.log(typeof t);case 5:case"end":return e.stop()}},e)}))},"list videos recorded today"),r.a.createElement("button",{onClick:function(){y(!S)}},"toggle brightness detection"),r.a.createElement("button",{style:{color:L?"red":"black"},onClick:function(){return N(!L)}},"record 5 sec"),r.a.createElement("button",{onClick:ie},"record 5 sec indefinitely"),r.a.createElement("br",null),r.a.createElement("ul",null,f.map(function(e,t){return r.a.createElement("li",{key:t},e)})),r.a.createElement("br",null),r.a.createElement(x,{videoRef:i,triggerRecording:L,duration:H,showPreview:n,onComplete:function(e){console.log(e),function(e){var t=A()().format("YYYY-MM-DDTHH:mm:ss:SSS"),n=A()().format("YYYY-MM-DD");I.storage().ref("".concat("videos","/").concat(t,".mp4")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var a=e.ref.location.path;I.firestore().collection("videoURL").doc(n).collection("urls").doc().set({url:a}).then(function(e){var n="pushVideoDataToStorage: COMPLETE video:".concat("videos","/").concat(t,".mp4, ref: ").concat(a,", callback: ").concat(e);T(n,function(){return console.log(n)})})}).catch(function(e){var t="pushVideoDataToStorage: ERROR ".concat(e);T(t,function(){return console.log(t)})})}(e),N(!1)}}),r.a.createElement(z,null),r.a.createElement(M,{videoRef:i,isDetecting:S,delay:1e3,onDetect:function(e){return E(e.bright)}}))},J=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(H,null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[155,1,2]]]);
//# sourceMappingURL=main.412043ae.chunk.js.map