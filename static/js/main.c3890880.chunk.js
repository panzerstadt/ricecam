(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{152:function(e,t,n){e.exports={gallery:"Show_gallery__34GpT"}},155:function(e,t,n){e.exports=n(333)},160:function(e,t,n){},161:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},162:function(e,t,n){},248:function(e,t){},250:function(e,t){},283:function(e,t){},284:function(e,t){},330:function(e,t){},331:function(e,t){},332:function(e,t){},333:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(147),c=n.n(r),i=(n(160),n(148)),s=n(149),u=n(153),l=n(150),d=n(154),m=(n(161),n(162),n(28)),f=n(27),g=n(6),p=n(7),b=n.n(p),v=(n(96),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)(function(){n.current=e},[e]),Object(a.useEffect)(function(){if(null!==t){var e=setInterval(function(){n.current()},t);return function(){return clearInterval(e)}}},[t])}),E=n(8),R=n.n(E),A=n(16),h=n(151),j=n.n(h),P=void 0,O={width:1080,height:1080,facingMode:"environment"},_=function(e){var t=e.onRef,n=Object(a.useRef)(),r=Object(a.useState)(!1),c=Object(g.a)(r,2),i=c[0],s=c[1],u=function(){var e=Object(A.a)(R.a.mark(function e(){var t;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=4;break}throw t="Browser API navigator.mediaDevices.getUserMedia not available",P.setState({error_messages:t}),t;case 4:n.current.video.onloadedmetadata=function(){s(!0)};case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)(function(){u()},[n]),i&&t&&t(n),o.a.createElement(j.a,{audio:!1,ref:n,screenshotFormat:"image/jpeg",videoConstraints:O,height:400,width:400})},S=(n(152),_),D=n(67),w=n.n(D),C={apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).apiKey,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).authDomain,databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).databaseURL,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).projectId,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).storageBucket,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"}).messagingSenderId},y={};Object.keys(C).map(function(e){y[e]=Object({NODE_ENV:"production",PUBLIC_URL:"/ricecam",REACT_APP_apiKey:"AIzaSyDSwRNP14oYjsb4rJvDjYbANatbaIBDI0A",REACT_APP_authDomain:"operation-verde-ricecam.firebaseapp.com",REACT_APP_databaseURL:"https://operation-verde-ricecam.firebaseio.com",REACT_APP_projectId:"operation-verde-ricecam",REACT_APP_storageBucket:"operation-verde-ricecam.appspot.com",REACT_APP_messagingSenderId:"231640672051"})["REACT_APP_".concat(e)]}),w.a.apps.length||w.a.initializeApp(y);var T=w.a;b.a.locale("ja");var I=function(e,t){var n=b()().format("YYYY-MM-DDTHH:mm:ss:SSS"),a=b()().format("YYYY-MM-DD");T.firestore().collection("logs").doc(a).collection("logs").doc(n).set({message:e},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)})},Y=function(){var e=Object(A.a)(R.a.mark(function e(t){var n,a,o,r,c,i,s,u,l,d,f,g,p;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e,t){var a={};for(var o in e)switch(typeof e[o]){case"function":t&&(a[o]="function: ".concat(e[o]));break;case"object":a[o]=n(e[o],t);break;case"number":a[o]=e[o];break;default:a[o]=e[o]}return a},a=b()().format("YYYY-MM-DDTHH:mm:ss:SSS"),o=b()().format("YYYY-MM-DD"),!("storage"in navigator&&"estimate"in navigator.storage)){e.next=10;break}return e.next=6,navigator.storage.estimate();case 6:c=e.sent,r={usage:c.usage,quota:c.quota,percent:"".concat((100*c.usage/c.quota).toFixed(0)," used")},e.next=11;break;case 10:r="browser does not have storage API";case 11:if(i=window.performance.memory||{},s="".concat(navigator.deviceMemory," GB")||!1,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection||navigator.msConnection,l=u?u.effectiveType:"browser does not have connection API",!("getBattery"in navigator)){e.next=19;break}return e.next=18,navigator.getBattery();case 18:d=e.sent;case 19:f=d?d.level:"browser does not have battery API",g=n(window.performance,!1),p={storage:r,ram:s,network:l,battery:f,performance:g,browserMemory:Object(m.a)({},n(i,!1),{usage:"".concat(i.totalJSHeapSize/i.jsHeapSizeLimit*100," percent"),comment:"units in bytes. percent is percent of allocated browser memory (multiple tabs included)"})},T.firestore().collection("logs").doc(o).collection("browser performance logs").doc(a).set({status:p},{merge:!0}).then(function(e){t&&t(e)}).catch(function(e){return console.log("LOGGING ERROR: ",e)});case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(e){var t=e.videoRef,n=e.triggerRecording,r=e.duration,c=e.onComplete,i=e.showPreview,s="video/webm",u=".mp4",l=Object(a.useState)(""),d=Object(g.a)(l,2),m=d[0],p=d[1],b=Object(a.useState)(5e3),v=Object(g.a)(b,2),E=v[0],R=v[1];Object(a.useEffect)(function(){r&&"number"===typeof r&&R(r)},[r]);var A=Object(a.useState)(!1),h=Object(g.a)(A,2),j=h[0],P=(h[1],Object(a.useState)([])),O=Object(g.a)(P,2),_=(O[0],O[1],Object(a.useState)([])),S=Object(g.a)(_,2),D=S[0],w=S[1];Object(a.useRef)();Object(a.useEffect)(function(){!0===n&&!1===j&&(I("VideoRecorder: START starting one recording"),y({duration:E}))},[n,j]),Object(a.useEffect)(function(){D.length>0&&(console.log("making link!",D),i&&C())},[D]);var C=function(){var e=new Blob(D,{type:s}),t=URL.createObjectURL(e),n=o.a.createElement("li",{key:t},o.a.createElement("video",{height:200,controls:!0,src:t}),o.a.createElement("br",null),o.a.createElement("a",{href:t,download:"video".concat(u)},"download ".concat("video".concat(u))));p([].concat(Object(f.a)(m),[n]))},y=function(e){if(e.duration,t){var n=t.current.stream;n.active||console.log("media stream is not active.",n);var a=new MediaRecorder(n);a.ondataavailable=function(e){w([e.data]),c&&c(e.data)},a.onstart=function(e){w([]),setTimeout(function(){a.stop()},E)},a.start()}};return o.a.createElement("ul",{style:{display:"flex",listStyleType:"none",width:"100%",overflowX:"scroll"}},m)},B=n(68),N=function(){var e=Object(A.a)(R.a.mark(function e(){return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.a("assets/model/brightness-predictor.json");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(A.a)(R.a.mark(function e(t){var n;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N();case 2:if(!(n=e.sent)){e.next=7;break}return e.next=6,B.c(function(){var e=[Array.from(t)],a=B.b(e,[e.length,432]);console.log(a);var o=n.predict(a);return o.print(),o.arraySync()[0][0]});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(A.a)(R.a.mark(function e(t){var n,a,o;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getContext("2d").getImageData(0,0,t.width,t.height),console.log(n),a=n.data,e.next=5,U(a);case 5:return o=e.sent,console.log(o),e.abrupt("return",o>.6);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(e){var t=e.videoRef,n=e.isDetecting,o=e.delay,r=e.onDetect,c=Object(a.useState)(500),i=Object(g.a)(c,2),s=i[0],u=i[1];Object(a.useEffect)(function(){o&&"number"===typeof o&&u(o)},[o]),v(function(){l()},n?s:null);var l=function(){var e=Object(A.a)(R.a.mark(function e(){var n,a,o;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return n=t.current.video,(a=document.createElement("canvas")).width=12,a.height=9,a.getContext("2d").drawImage(n,0,0,a.width,a.height),e.next=9,L(a);case 9:o=e.sent,r&&r({bright:o});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return null};b.a.locale("ja");var x=function(e){var t=e.videoRef,n=e.streamDelay,a=e.isStreaming;v(function(){r()},a?n:null);var r=function(){if(t){var e=t.current.video,n=document.createElement("canvas");n.width=1*e.videoWidth,n.height=1*e.videoHeight,n.getContext("2d").drawImage(e,0,0,n.width,n.height);n.toDataURL();n.toBlob(function(e){console.log(e),function(e){var t=b()().format("YYYY-MM-DDTHH:mm:ss:SSS"),n=b()().format("YYYY-MM-DD");console.log("pushing Image blob: ",e),T.storage().ref("".concat("images","/").concat(t,".png")).put(e).then(function(e){console.log("image blob pushed to: ".concat(e.ref.location.path),e);var t=e.ref.location.path;T.firestore().collection("imageURL").doc(n).collection("urls").doc().set({url:t})}).catch(function(e){var t="pushImageDataToStorage: ERROR ".concat(JSON.stringify(e));console.log(t),I(t)})}(e)})}};return o.a.createElement("p",null," DEBUG: photo streaming: ","".concat(a))},J=function(e,t){if(console.log(e,t),!e||!t)return!1;var n=b()(),a=e.slice(0,2),o=e.slice(2),r=b()().hour(a).minute(o),c=t.slice(0,2),i=t.slice(2),s=b()().hour(c).minute(i),u=n.isAfter(r),l=n.isBefore(s);return u&&l},G=function(e){var t=e.showPreviews,n=void 0!==t&&t,r=Object(a.useState)(),c=Object(g.a)(r,2),i=c[0],s=c[1],u=Object(a.useState)([]),l=Object(g.a)(u,2),d=l[0],p=l[1],E=Object(a.useState)(!0),R=Object(g.a)(E,2),A=R[0],h=R[1],j=function(e){p(function(t){return[].concat(Object(f.a)(t.slice(-4)),[e])}),I(e,function(e){return console.log("LOGGER: completed. ",e)})};v(function(){console.log("logging browser performance"),Y()},6e4);var P=Object(a.useState)(!1),O=Object(g.a)(P,2),_=O[0],D=O[1],w=Object(a.useState)(!1),C=Object(g.a)(w,2),y=C[0],B=C[1],N=Object(a.useState)(5e3),U=Object(g.a)(N,2),L=U[0],G=U[1],H=Object(a.useState)({start:null,end:null}),z=Object(g.a)(H,2),V=z[0],K=z[1],q=Object(a.useState)(!1),F=Object(g.a)(q,2),W=F[0],X=F[1],$=Object(a.useState)(5),Q=Object(g.a)($,2),Z=Q[0],ee=Q[1];v(function(){var e=b()().format("YYYY-MM-DDTHH:mm:ss:SSS");!y&&J(V.start,V.end)?(j("recording video at ".concat(e)),console.log("within timer?? ",J(V.start,V.end)),B(!0)):j("recording still underway, not setting recording to true")},W?6e4*Z:null);var te=Object(a.useState)({}),ne=Object(g.a)(te,2),ae=ne[0],oe=ne[1];Object(a.useEffect)(function(){var e;i&&(console.log("listening to DB!"),e=oe,T.firestore().collection("appState").doc("commands").onSnapshot(function(t){return e&&e(t.data()),t.data()}))},[i]);var re=function(e){e?(j("setting continuous recording to ".concat(ae.setContinuousRecording)),ue(function(e){return Object(m.a)({},e,{isContinuouslyRecording:!0,isRecording:!0})}),B(!0),X(!0)):(j("setting continuous recording to ".concat(ae.setContinuousRecording)),ue(function(e){return Object(m.a)({},e,{isContinuouslyRecording:!1,isRecording:!1})}),B(!1),X(!1))};Object(a.useEffect)(function(){var e,t,n;ae&&(j("commands received: ".concat(JSON.stringify(ae))),V.start===ae.timerStart&&V.end===ae.timerEnd||(n={start:ae.timerStart,end:ae.timerEnd},j("setting timers to ".concat(JSON.stringify(n))),n.start&&n.end&&(ue(function(e){return Object(m.a)({},e,{isTimerSet:!0})}),K(n))),W!==ae.setContinuousRecording&&re(ae.setContinuousRecording),L!==ae.videoDurationSec&&(t=ae.videoDurationSec,j("setting recording duration to ".concat(ae.videoDurationSec," secs")),G(t)),Z!==ae.videoRecordFreqMin&&(e=ae.videoRecordFreqMin,j("setting recording interval to ".concat(ae.videoRecordFreqMin," mins")),ee(e)))},[ae]);var ce=Object(a.useState)({isContinuouslyRecording:null,isRecording:null,isTimerSet:null,nextRecordingTime:null}),ie=Object(g.a)(ce,2),se=ie[0],ue=ie[1];Object(a.useEffect)(function(){var e;e=se,T.firestore().collection("appState").doc("currentState").set(e,{merge:!0}).then(function(e){return console.log("REMOTE STATE UPDATER: complete. ",e)}).catch(function(e){return console.log("REMOTE DB STATE UPDATE ERROR: ",e)})},[se]);var le=Object(a.useState)(100),de=Object(g.a)(le,2),me=de[0],fe=(de[1],Object(a.useState)(!1)),ge=Object(g.a)(fe,2),pe=ge[0],be=ge[1];Object(a.useEffect)(function(){ae&&pe!==ae.debugStreamImages&&(ae.debugStreamImages?(j("DEBUG: streaming images to database!"),be(!0)):(j("DEBUG: stopping image stream!"),be(!1)))},[ae]);return Object(a.useEffect)(function(){if(i){var e=i.current.video;e.height=.1*e.videoHeight,e.width=.1*e.videoWidth,console.log(i.current.video)}},[i]),o.a.createElement("div",{style:{backgroundColor:A?"white":"#282c34"}},o.a.createElement(S,{onRef:s}),o.a.createElement("br",null),o.a.createElement("code",null,"debug buttons: "),o.a.createElement("button",{style:{color:pe?"red":"orange"},onClick:function(){pe?(j("image streaming stopped!"),be(!1)):(j("streaming images to database!"),be(!0))}},"DEBUG: toggle stream to database"),o.a.createElement("button",{onClick:function(){D(!_)}},"toggle brightness detection"),o.a.createElement("button",{style:{color:y?"red":"black"},onClick:function(e){j("recording video once"),ue(function(e){return Object(m.a)({},e,{isRecording:!0})}),B(!0)}},"record 5 sec"),o.a.createElement("button",{onClick:re,style:{color:W?"red":"black"}},"record 5 sec indefinitely"),o.a.createElement("br",null),o.a.createElement("ul",null,d.map(function(e,t){return o.a.createElement("li",{key:t},e)})),o.a.createElement("br",null),o.a.createElement(k,{videoRef:i,triggerRecording:y,duration:L,showPreview:n,onComplete:function(e){console.log(e),function(e){var t=b()().format("YYYY-MM-DDTHH:mm:ss:SSS"),n=b()().format("YYYY-MM-DD");T.storage().ref("".concat("videos","/").concat(t,".mp4")).put(e).then(function(e){console.log(e),console.log(e.ref.location.path);var a=e.ref.location.path;T.firestore().collection("videoURL").doc(n).collection("urls").doc().set({url:a}).then(function(e){var n="pushVideoDataToStorage: COMPLETE video:".concat("videos","/").concat(t,".mp4, ref: ").concat(a,", callback: ").concat(e);I(n,function(){return console.log(n)})})}).catch(function(e){var t="pushVideoDataToStorage: ERROR ".concat(JSON.stringify(e));I(t,function(){return console.log(t)})})}(e),ue(function(e){return Object(m.a)({},e,{isRecording:!1})}),B(!1)}}),o.a.createElement(x,{videoRef:i,showPreview:n,streamDelay:me,isStreaming:pe}),o.a.createElement("br",null),o.a.createElement("h3",null,"local state:"),JSON.stringify(se,null,2),o.a.createElement("h3",null,"db state"),JSON.stringify(ae,null,2),o.a.createElement(M,{videoRef:i,isDetecting:_,delay:1e3,onDetect:function(e){return h(e.bright)}}))},H=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("p",null,"v1.1"),o.a.createElement("br",null),o.a.createElement(G,null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[155,1,2]]]);
//# sourceMappingURL=main.c3890880.chunk.js.map